{"filter":false,"title":"app.py","tooltip":"/application-code/app.py","undoManager":{"mark":8,"position":8,"stack":[[{"start":{"row":135,"column":35},"end":{"row":135,"column":36},"action":"remove","lines":["0"],"id":2},{"start":{"row":135,"column":34},"end":{"row":135,"column":35},"action":"remove","lines":["8"]},{"start":{"row":135,"column":33},"end":{"row":135,"column":34},"action":"remove","lines":["0"]}],[{"start":{"row":135,"column":33},"end":{"row":135,"column":34},"action":"insert","lines":["1"],"id":3}],[{"start":{"row":0,"column":0},"end":{"row":136,"column":0},"action":"remove","lines":["from flask import Flask, render_template, request","from pymysql import connections","import os","import random","import argparse","","","app = Flask(__name__)","","DBHOST = os.environ.get(\"DBHOST\") or \"localhost\"","DBUSER = os.environ.get(\"DBUSER\") or \"root\"","DBPWD = os.environ.get(\"DBPWD\") or \"passwors\"","DATABASE = os.environ.get(\"DATABASE\") or \"employees\"","COLOR_FROM_ENV = os.environ.get('APP_COLOR') or \"lime\"","DBPORT = int(os.environ.get(\"DBPORT\"))","","# Create a connection to the MySQL database","db_conn = connections.Connection(","    host= DBHOST,","    port=DBPORT,","    user= DBUSER,","    password= DBPWD, ","    db= DATABASE","    ",")","output = {}","table = 'employee';","","# Define the supported color codes","color_codes = {","    \"red\": \"#e74c3c\",","    \"green\": \"#16a085\",","    \"blue\": \"#89CFF0\",","    \"blue2\": \"#30336b\",","    \"pink\": \"#f4c2c2\",","    \"darkblue\": \"#130f40\",","    \"lime\": \"#C1FF9C\",","}","","","# Create a string of supported colors","SUPPORTED_COLORS = \",\".join(color_codes.keys())","","# Generate a random color","COLOR = random.choice([\"red\", \"green\", \"blue\", \"blue2\", \"darkblue\", \"pink\", \"lime\"])","","","@app.route(\"/\", methods=['GET', 'POST'])","def home():","    return render_template('addemp.html', color=color_codes[COLOR])","","@app.route(\"/about\", methods=['GET','POST'])","def about():","    return render_template('about.html', color=color_codes[COLOR])","    ","@app.route(\"/addemp\", methods=['POST'])","def AddEmp():","    emp_id = request.form['emp_id']","    first_name = request.form['first_name']","    last_name = request.form['last_name']","    primary_skill = request.form['primary_skill']","    location = request.form['location']","","  ","    insert_sql = \"INSERT INTO employee VALUES (%s, %s, %s, %s, %s)\"","    cursor = db_conn.cursor()","","    try:","        ","        cursor.execute(insert_sql,(emp_id, first_name, last_name, primary_skill, location))","        db_conn.commit()","        emp_name = \"\" + first_name + \" \" + last_name","","    finally:","        cursor.close()","","    print(\"all modification done...\")","    return render_template('addempoutput.html', name=emp_name, color=color_codes[COLOR])","","@app.route(\"/getemp\", methods=['GET', 'POST'])","def GetEmp():","    return render_template(\"getemp.html\", color=color_codes[COLOR])","","","@app.route(\"/fetchdata\", methods=['GET','POST'])","def FetchData():","    emp_id = request.form['emp_id']","","    output = {}","    select_sql = \"SELECT emp_id, first_name, last_name, primary_skill, location from employee where emp_id=%s\"","    cursor = db_conn.cursor()","","    try:","        cursor.execute(select_sql,(emp_id))","        result = cursor.fetchone()","        ","        # Add No Employee found form","        output[\"emp_id\"] = result[0]","        output[\"first_name\"] = result[1]","        output[\"last_name\"] = result[2]","        output[\"primary_skills\"] = result[3]","        output[\"location\"] = result[4]","        ","    except Exception as e:","        print(e)","","    finally:","        cursor.close()","","    return render_template(\"getempoutput.html\", id=output[\"emp_id\"], fname=output[\"first_name\"],","                           lname=output[\"last_name\"], interest=output[\"primary_skills\"], location=output[\"location\"], color=color_codes[COLOR])","","if __name__ == '__main__':","    ","    # Check for Command Line Parameters for color","    parser = argparse.ArgumentParser()","    parser.add_argument('--color', required=False)","    args = parser.parse_args()","","    if args.color:","        print(\"Color from command line argument =\" + args.color)","        COLOR = args.color","        if COLOR_FROM_ENV:","            print(\"A color was set through environment variable -\" + COLOR_FROM_ENV + \". However, color from command line argument takes precendence.\")","    elif COLOR_FROM_ENV:","        print(\"No Command line argument. Color from environment variable =\" + COLOR_FROM_ENV)","        COLOR = COLOR_FROM_ENV","    else:","        print(\"No command line argument or environment variable. Picking a Random Color =\" + COLOR)","","    # Check if input color is a supported one","    if COLOR not in color_codes:","        print(\"Color not supported. Received '\" + COLOR + \"' expected one of \" + SUPPORTED_COLORS)","        exit(1)","","    app.run(host='0.0.0.0',port=81,debug=True)",""],"id":4}],[{"start":{"row":0,"column":0},"end":{"row":128,"column":55},"action":"insert","lines":["from flask import Flask, render_template, request","from pymysql import connections","import os","import argparse","import boto3","import logging","","app = Flask(__name__)","","# DB Config from environment (Secrets in K8s)","DBHOST = os.environ.get(\"DBHOST\", \"localhost\")","DBUSER = os.environ.get(\"DBUSER\", \"root\")","DBPWD = os.environ.get(\"DBPWD\", \"password\")","DATABASE = os.environ.get(\"DATABASE\", \"employees\")","DBPORT = int(os.environ.get(\"DBPORT\", 3306))","","# Group info from ConfigMap","GROUP_NAME = os.environ.get(\"GROUP_NAME\", \"CLO835 Team\")","GROUP_SLOGAN = os.environ.get(\"GROUP_SLOGAN\", \"Delivering Cloud Excellence\")","","# Background image info from ConfigMap","BG_BUCKET = os.environ.get(\"BG_BUCKET\")","BG_KEY = os.environ.get(\"BG_KEY\")  # e.g., \"background.jpg\"","","# AWS credentials from Secrets","AWS_ACCESS_KEY_ID = os.environ.get(\"AWS_ACCESS_KEY_ID\")","AWS_SECRET_ACCESS_KEY = os.environ.get(\"AWS_SECRET_ACCESS_KEY\")","AWS_REGION = os.environ.get(\"AWS_REGION\", \"us-east-1\")","","# Static file path","BG_LOCAL_PATH = os.path.join(\"static\", \"background.jpg\")","","# Logging setup","logging.basicConfig(level=logging.INFO)","","# Download background image from private S3","def download_background():","    if not BG_BUCKET or not BG_KEY:","        app.logger.warning(\"Background image S3 details are not set.\")","        return","    try:","        s3_client = boto3.client(","            \"s3\",","            aws_access_key_id=AWS_ACCESS_KEY_ID,","            aws_secret_access_key=AWS_SECRET_ACCESS_KEY,","            region_name=AWS_REGION","        )","        s3_client.download_file(BG_BUCKET, BG_KEY, BG_LOCAL_PATH)","        app.logger.info(f\"Background image downloaded from s3://{BG_BUCKET}/{BG_KEY}\")","    except Exception as e:","        app.logger.error(f\"Failed to download background image: {e}\")","","# MySQL Connection","db_conn = connections.Connection(","    host=DBHOST,","    port=DBPORT,","    user=DBUSER,","    password=DBPWD,","    db=DATABASE",")","","@app.route(\"/\", methods=['GET', 'POST'])","def home():","    return render_template('addemp.html', group_name=GROUP_NAME, group_slogan=GROUP_SLOGAN)","","@app.route(\"/about\", methods=['GET','POST'])","def about():","    return render_template('about.html', group_name=GROUP_NAME, group_slogan=GROUP_SLOGAN)","","@app.route(\"/addemp\", methods=['POST'])","def AddEmp():","    emp_id = request.form['emp_id']","    first_name = request.form['first_name']","    last_name = request.form['last_name']","    primary_skill = request.form['primary_skill']","    location = request.form['location']","","    insert_sql = \"INSERT INTO employee VALUES (%s, %s, %s, %s, %s)\"","    cursor = db_conn.cursor()","    try:","        cursor.execute(insert_sql, (emp_id, first_name, last_name, primary_skill, location))","        db_conn.commit()","        emp_name = f\"{first_name} {last_name}\"","    finally:","        cursor.close()","","    return render_template('addempoutput.html', name=emp_name, group_name=GROUP_NAME, group_slogan=GROUP_SLOGAN)","","@app.route(\"/getemp\", methods=['GET', 'POST'])","def GetEmp():","    return render_template(\"getemp.html\", group_name=GROUP_NAME, group_slogan=GROUP_SLOGAN)","","@app.route(\"/fetchdata\", methods=['GET','POST'])","def FetchData():","    emp_id = request.form['emp_id']","    output = {}","    select_sql = \"SELECT emp_id, first_name, last_name, primary_skill, location FROM employee WHERE emp_id=%s\"","    cursor = db_conn.cursor()","","    try:","        cursor.execute(select_sql, (emp_id,))","        result = cursor.fetchone()","        if result:","            output[\"emp_id\"], output[\"first_name\"], output[\"last_name\"], output[\"primary_skills\"], output[\"location\"] = result","        else:","            return f\"No employee found with ID {emp_id}\"","    except Exception as e:","        app.logger.error(e)","    finally:","        cursor.close()","","    return render_template(","        \"getempoutput.html\",","        id=output[\"emp_id\"],","        fname=output[\"first_name\"],","        lname=output[\"last_name\"],","        interest=output[\"primary_skills\"],","        location=output[\"location\"],","        group_name=GROUP_NAME,","        group_slogan=GROUP_SLOGAN","    )","","if __name__ == '__main__':","    parser = argparse.ArgumentParser()","    parser.add_argument('--port', required=False, type=int, default=81)","    args = parser.parse_args()","","    download_background()","    app.run(host='0.0.0.0', port=args.port, debug=True)"],"id":5}],[{"start":{"row":0,"column":0},"end":{"row":128,"column":55},"action":"remove","lines":["from flask import Flask, render_template, request","from pymysql import connections","import os","import argparse","import boto3","import logging","","app = Flask(__name__)","","# DB Config from environment (Secrets in K8s)","DBHOST = os.environ.get(\"DBHOST\", \"localhost\")","DBUSER = os.environ.get(\"DBUSER\", \"root\")","DBPWD = os.environ.get(\"DBPWD\", \"password\")","DATABASE = os.environ.get(\"DATABASE\", \"employees\")","DBPORT = int(os.environ.get(\"DBPORT\", 3306))","","# Group info from ConfigMap","GROUP_NAME = os.environ.get(\"GROUP_NAME\", \"CLO835 Team\")","GROUP_SLOGAN = os.environ.get(\"GROUP_SLOGAN\", \"Delivering Cloud Excellence\")","","# Background image info from ConfigMap","BG_BUCKET = os.environ.get(\"BG_BUCKET\")","BG_KEY = os.environ.get(\"BG_KEY\")  # e.g., \"background.jpg\"","","# AWS credentials from Secrets","AWS_ACCESS_KEY_ID = os.environ.get(\"AWS_ACCESS_KEY_ID\")","AWS_SECRET_ACCESS_KEY = os.environ.get(\"AWS_SECRET_ACCESS_KEY\")","AWS_REGION = os.environ.get(\"AWS_REGION\", \"us-east-1\")","","# Static file path","BG_LOCAL_PATH = os.path.join(\"static\", \"background.jpg\")","","# Logging setup","logging.basicConfig(level=logging.INFO)","","# Download background image from private S3","def download_background():","    if not BG_BUCKET or not BG_KEY:","        app.logger.warning(\"Background image S3 details are not set.\")","        return","    try:","        s3_client = boto3.client(","            \"s3\",","            aws_access_key_id=AWS_ACCESS_KEY_ID,","            aws_secret_access_key=AWS_SECRET_ACCESS_KEY,","            region_name=AWS_REGION","        )","        s3_client.download_file(BG_BUCKET, BG_KEY, BG_LOCAL_PATH)","        app.logger.info(f\"Background image downloaded from s3://{BG_BUCKET}/{BG_KEY}\")","    except Exception as e:","        app.logger.error(f\"Failed to download background image: {e}\")","","# MySQL Connection","db_conn = connections.Connection(","    host=DBHOST,","    port=DBPORT,","    user=DBUSER,","    password=DBPWD,","    db=DATABASE",")","","@app.route(\"/\", methods=['GET', 'POST'])","def home():","    return render_template('addemp.html', group_name=GROUP_NAME, group_slogan=GROUP_SLOGAN)","","@app.route(\"/about\", methods=['GET','POST'])","def about():","    return render_template('about.html', group_name=GROUP_NAME, group_slogan=GROUP_SLOGAN)","","@app.route(\"/addemp\", methods=['POST'])","def AddEmp():","    emp_id = request.form['emp_id']","    first_name = request.form['first_name']","    last_name = request.form['last_name']","    primary_skill = request.form['primary_skill']","    location = request.form['location']","","    insert_sql = \"INSERT INTO employee VALUES (%s, %s, %s, %s, %s)\"","    cursor = db_conn.cursor()","    try:","        cursor.execute(insert_sql, (emp_id, first_name, last_name, primary_skill, location))","        db_conn.commit()","        emp_name = f\"{first_name} {last_name}\"","    finally:","        cursor.close()","","    return render_template('addempoutput.html', name=emp_name, group_name=GROUP_NAME, group_slogan=GROUP_SLOGAN)","","@app.route(\"/getemp\", methods=['GET', 'POST'])","def GetEmp():","    return render_template(\"getemp.html\", group_name=GROUP_NAME, group_slogan=GROUP_SLOGAN)","","@app.route(\"/fetchdata\", methods=['GET','POST'])","def FetchData():","    emp_id = request.form['emp_id']","    output = {}","    select_sql = \"SELECT emp_id, first_name, last_name, primary_skill, location FROM employee WHERE emp_id=%s\"","    cursor = db_conn.cursor()","","    try:","        cursor.execute(select_sql, (emp_id,))","        result = cursor.fetchone()","        if result:","            output[\"emp_id\"], output[\"first_name\"], output[\"last_name\"], output[\"primary_skills\"], output[\"location\"] = result","        else:","            return f\"No employee found with ID {emp_id}\"","    except Exception as e:","        app.logger.error(e)","    finally:","        cursor.close()","","    return render_template(","        \"getempoutput.html\",","        id=output[\"emp_id\"],","        fname=output[\"first_name\"],","        lname=output[\"last_name\"],","        interest=output[\"primary_skills\"],","        location=output[\"location\"],","        group_name=GROUP_NAME,","        group_slogan=GROUP_SLOGAN","    )","","if __name__ == '__main__':","    parser = argparse.ArgumentParser()","    parser.add_argument('--port', required=False, type=int, default=81)","    args = parser.parse_args()","","    download_background()","    app.run(host='0.0.0.0', port=args.port, debug=True)"],"id":6}],[{"start":{"row":0,"column":0},"end":{"row":128,"column":55},"action":"insert","lines":["from flask import Flask, render_template, request","from pymysql import connections","import os","import argparse","import boto3","import logging","","app = Flask(__name__)","","# DB Config from environment (Secrets in K8s)","DBHOST = os.environ.get(\"DBHOST\", \"localhost\")","DBUSER = os.environ.get(\"DBUSER\", \"root\")","DBPWD = os.environ.get(\"DBPWD\", \"password\")","DATABASE = os.environ.get(\"DATABASE\", \"employees\")","DBPORT = int(os.environ.get(\"DBPORT\", 3306))","","# Group info from ConfigMap","GROUP_NAME = os.environ.get(\"GROUP_NAME\", \"CLO835 Team\")","GROUP_SLOGAN = os.environ.get(\"GROUP_SLOGAN\", \"Delivering Cloud Excellence\")","","# Background image info from ConfigMap","BG_BUCKET = os.environ.get(\"BG_BUCKET\")","BG_KEY = os.environ.get(\"BG_KEY\")  # e.g., \"background.jpg\"","","# AWS credentials from Secrets","AWS_ACCESS_KEY_ID = os.environ.get(\"AWS_ACCESS_KEY_ID\")","AWS_SECRET_ACCESS_KEY = os.environ.get(\"AWS_SECRET_ACCESS_KEY\")","AWS_REGION = os.environ.get(\"AWS_REGION\", \"us-east-1\")","","# Static file path","BG_LOCAL_PATH = os.path.join(\"static\", \"background.jpg\")","","# Logging setup","logging.basicConfig(level=logging.INFO)","","# Download background image from private S3","def download_background():","    if not BG_BUCKET or not BG_KEY:","        app.logger.warning(\"Background image S3 details are not set.\")","        return","    try:","        s3_client = boto3.client(","            \"s3\",","            aws_access_key_id=AWS_ACCESS_KEY_ID,","            aws_secret_access_key=AWS_SECRET_ACCESS_KEY,","            region_name=AWS_REGION","        )","        s3_client.download_file(BG_BUCKET, BG_KEY, BG_LOCAL_PATH)","        app.logger.info(f\"Background image downloaded from s3://{BG_BUCKET}/{BG_KEY}\")","    except Exception as e:","        app.logger.error(f\"Failed to download background image: {e}\")","","# MySQL Connection","db_conn = connections.Connection(","    host=DBHOST,","    port=DBPORT,","    user=DBUSER,","    password=DBPWD,","    db=DATABASE",")","","@app.route(\"/\", methods=['GET', 'POST'])","def home():","    return render_template('addemp.html', group_name=GROUP_NAME, group_slogan=GROUP_SLOGAN)","","@app.route(\"/about\", methods=['GET','POST'])","def about():","    return render_template('about.html', group_name=GROUP_NAME, group_slogan=GROUP_SLOGAN)","","@app.route(\"/addemp\", methods=['POST'])","def AddEmp():","    emp_id = request.form['emp_id']","    first_name = request.form['first_name']","    last_name = request.form['last_name']","    primary_skill = request.form['primary_skill']","    location = request.form['location']","","    insert_sql = \"INSERT INTO employee VALUES (%s, %s, %s, %s, %s)\"","    cursor = db_conn.cursor()","    try:","        cursor.execute(insert_sql, (emp_id, first_name, last_name, primary_skill, location))","        db_conn.commit()","        emp_name = f\"{first_name} {last_name}\"","    finally:","        cursor.close()","","    return render_template('addempoutput.html', name=emp_name, group_name=GROUP_NAME, group_slogan=GROUP_SLOGAN)","","@app.route(\"/getemp\", methods=['GET', 'POST'])","def GetEmp():","    return render_template(\"getemp.html\", group_name=GROUP_NAME, group_slogan=GROUP_SLOGAN)","","@app.route(\"/fetchdata\", methods=['GET','POST'])","def FetchData():","    emp_id = request.form['emp_id']","    output = {}","    select_sql = \"SELECT emp_id, first_name, last_name, primary_skill, location FROM employee WHERE emp_id=%s\"","    cursor = db_conn.cursor()","","    try:","        cursor.execute(select_sql, (emp_id,))","        result = cursor.fetchone()","        if result:","            output[\"emp_id\"], output[\"first_name\"], output[\"last_name\"], output[\"primary_skills\"], output[\"location\"] = result","        else:","            return f\"No employee found with ID {emp_id}\"","    except Exception as e:","        app.logger.error(e)","    finally:","        cursor.close()","","    return render_template(","        \"getempoutput.html\",","        id=output[\"emp_id\"],","        fname=output[\"first_name\"],","        lname=output[\"last_name\"],","        interest=output[\"primary_skills\"],","        location=output[\"location\"],","        group_name=GROUP_NAME,","        group_slogan=GROUP_SLOGAN","    )","","if __name__ == '__main__':","    parser = argparse.ArgumentParser()","    parser.add_argument('--port', required=False, type=int, default=81)","    args = parser.parse_args()","","    download_background()","    app.run(host='0.0.0.0', port=args.port, debug=True)"],"id":7}],[{"start":{"row":128,"column":33},"end":{"row":128,"column":42},"action":"remove","lines":["args.port"],"id":8},{"start":{"row":128,"column":33},"end":{"row":128,"column":34},"action":"insert","lines":["8"]},{"start":{"row":128,"column":34},"end":{"row":128,"column":35},"action":"insert","lines":["1"]}],[{"start":{"row":128,"column":0},"end":{"row":128,"column":48},"action":"remove","lines":["    app.run(host='0.0.0.0', port=81, debug=True)"],"id":9},{"start":{"row":128,"column":0},"end":{"row":128,"column":46},"action":"insert","lines":["  app.run(host='0.0.0.0',port=8080,debug=True)"]}],[{"start":{"row":128,"column":2},"end":{"row":128,"column":3},"action":"insert","lines":[" "],"id":10},{"start":{"row":128,"column":3},"end":{"row":128,"column":4},"action":"insert","lines":[" "]}]]},"ace":{"folds":[],"scrolltop":2024.9999999999993,"scrollleft":0,"selection":{"start":{"row":128,"column":4},"end":{"row":128,"column":4},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":105,"state":"start","mode":"ace/mode/python"}},"timestamp":1754709227483,"hash":"5e9dde98d3330125f059a1efbaf02bc928ed94f4"}